
#include <stdint.h>

//
// C implementation of this verilog:
//
//    C[0]  <= D[15] ^ D[13] ^ D[12] ^ D[11] ^ D[10] ^ D[9] ^ D[8] ^ 
//             D[7] ^ D[6] ^ D[5] ^ D[4] ^ D[3] ^ D[2] ^ D[1] ^ D[0] ^ 
//             C[0] ^ C[1] ^ C[2] ^ C[3] ^ C[4] ^ C[5] ^ C[6] ^ C[7] ^ 
//             C[8] ^ C[9] ^ C[10] ^ C[11] ^ C[12] ^ C[13] ^ C[15];
//    C[1]  <= D[14] ^ D[13] ^ D[12] ^ D[11] ^ D[10] ^ D[9] ^ D[8] ^ 
//             D[7] ^ D[6] ^ D[5] ^ D[4] ^ D[3] ^ D[2] ^ D[1] ^ C[1] ^ 
//             C[2] ^ C[3] ^ C[4] ^ C[5] ^ C[6] ^ C[7] ^ C[8] ^ C[9] ^ 
//             C[10] ^ C[11] ^ C[12] ^ C[13] ^ C[14];
//    C[2]  <= D[14] ^ D[1] ^ D[0] ^ C[0] ^ C[1] ^ C[14];
//    C[3]  <= D[15] ^ D[2] ^ D[1] ^ C[1] ^ C[2] ^ C[15];
//    C[4]  <= D[3] ^ D[2] ^ C[2] ^ C[3];
//    C[5]  <= D[4] ^ D[3] ^ C[3] ^ C[4];
//    C[6]  <= D[5] ^ D[4] ^ C[4] ^ C[5];
//    C[7]  <= D[6] ^ D[5] ^ C[5] ^ C[6];
//    C[8]  <= D[7] ^ D[6] ^ C[6] ^ C[7];
//    C[9]  <= D[8] ^ D[7] ^ C[7] ^ C[8];
//    C[10] <= D[9] ^ D[8] ^ C[8] ^ C[9];
//    C[11] <= D[10] ^ D[9] ^ C[9] ^ C[10];
//    C[12] <= D[11] ^ D[10] ^ C[10] ^ C[11];
//    C[13] <= D[12] ^ D[11] ^ C[11] ^ C[12];
//    C[14] <= D[13] ^ D[12] ^ C[12] ^ C[13];
//    C[15] <= D[15] ^ D[14] ^ D[12] ^ D[11] ^ D[10] ^ D[9] ^ D[8] ^ 
//             D[7] ^ D[6] ^ D[5] ^ D[4] ^ D[3] ^ D[2] ^ D[1] ^ D[0] ^ 
//             C[0] ^ C[1] ^ C[2] ^ C[3] ^ C[4] ^ C[5] ^ C[6] ^ C[7] ^ 
//             C[8] ^ C[9] ^ C[10] ^ C[11] ^ C[12] ^ C[14] ^ C[15];


uint16_t crc16( uint16_t crc_in, uint16_t data)
{
  uint16_t res = 

    ( ((data>>15)&1) ^ ((data>>13)&1) ^ ((data>>12)&1) ^ ((data>>11)&1) ^ ((data>>10)&1) ^ ((data>>9)&1) ^ ((data>>8)&1) ^ 
      ((data>>7)&1) ^ ((data>>6)&1) ^ ((data>>5)&1) ^ ((data>>4)&1) ^ ((data>>3)&1) ^ ((data>>2)&1) ^ ((data>>1)&1) ^ ((data>>0)&1) ^ 
      ((crc_in>>0)&1) ^ ((crc_in>>1)&1) ^ ((crc_in>>2)&1) ^ ((crc_in>>3)&1) ^ ((crc_in>>4)&1) ^ ((crc_in>>5)&1) ^ ((crc_in>>6)&1) ^ ((crc_in>>7)&1) ^ 
      ((crc_in>>8)&1) ^ ((crc_in>>9)&1) ^ ((crc_in>>10)&1) ^ ((crc_in>>11)&1) ^ ((crc_in>>12)&1) ^ ((crc_in>>13)&1) ^ ((crc_in>>15)&1) ) |

    (( ((data>>14)&1) ^ ((data>>13)&1) ^ ((data>>12)&1) ^ ((data>>11)&1) ^ ((data>>10)&1) ^ ((data>>9)&1) ^ ((data>>8)&1) ^ 
       ((data>>7)&1) ^ ((data>>6)&1) ^ ((data>>5)&1) ^ ((data>>4)&1) ^ ((data>>3)&1) ^ ((data>>2)&1) ^ ((data>>1)&1) ^ ((crc_in>>1)&1) ^ 
       ((crc_in>>2)&1) ^ ((crc_in>>3)&1) ^ ((crc_in>>4)&1) ^ ((crc_in>>5)&1) ^ ((crc_in>>6)&1) ^ ((crc_in>>7)&1) ^ ((crc_in>>8)&1) ^ ((crc_in>>9)&1) ^ 
       ((crc_in>>10)&1) ^ ((crc_in>>11)&1) ^ ((crc_in>>12)&1) ^ ((crc_in>>13)&1) ^ ((crc_in>>14)&1)) << 1) |

    ( (((data>>14)&1) ^ ((data>>1)&1) ^ ((data>>0)&1) ^ ((crc_in>>0)&1) ^ ((crc_in>>1)&1) ^ ((crc_in>>14)&1)) << 2) |

    (( ((data>>15)&1) ^ ((data>>2)&1) ^ ((data>>1)&1) ^ ((crc_in>>1)&1) ^ ((crc_in>>2)&1) ^ ((crc_in>>15)&1)) << 3) |

    (( ((data>>3)&1) ^ ((data>>2)&1) ^ ((crc_in>>2)&1) ^ ((crc_in>>3)&1)) << 4) |

    (( ((data>>4)&1) ^ ((data>>3)&1) ^ ((crc_in>>3)&1) ^ ((crc_in>>4)&1)) << 5) |

    (( ((data>>5)&1) ^ ((data>>4)&1) ^ ((crc_in>>4)&1) ^ ((crc_in>>5)&1)) << 6) |

    (( ((data>>6)&1) ^ ((data>>5)&1) ^ ((crc_in>>5)&1) ^ ((crc_in>>6)&1)) << 7) |

    (( ((data>>7)&1) ^ ((data>>6)&1) ^ ((crc_in>>6)&1) ^ ((crc_in>>7)&1)) << 8) |

    (( ((data>>8)&1) ^ ((data>>7)&1) ^ ((crc_in>>7)&1) ^ ((crc_in>>8)&1)) << 9) |

    (( ((data>>9)&1) ^ ((data>>8)&1) ^ ((crc_in>>8)&1) ^ ((crc_in>>9)&1)) << 10) |

    (( ((data>>10)&1) ^ ((data>>9)&1) ^ ((crc_in>>9)&1) ^ ((crc_in>>10)&1)) << 11) |

    (( ((data>>11)&1) ^ ((data>>10)&1) ^ ((crc_in>>10)&1) ^ ((crc_in>>11)&1)) << 12) |

    (( ((data>>12)&1) ^ ((data>>11)&1) ^ ((crc_in>>11)&1) ^ ((crc_in>>12)&1)) << 13) |

    (( ((data>>13)&1) ^ ((data>>12)&1) ^ ((crc_in>>12)&1) ^ ((crc_in>>13)&1)) << 14) |

    (( ((data>>15)&1) ^ ((data>>14)&1) ^ ((data>>12)&1) ^ ((data>>11)&1) ^ ((data>>10)&1) ^ ((data>>9)&1) ^ ((data>>8)&1) ^ 
       ((data>>7)&1) ^ ((data>>6)&1) ^ ((data>>5)&1) ^ ((data>>4)&1) ^ ((data>>3)&1) ^ ((data>>2)&1) ^ ((data>>1)&1) ^ ((data>>0)&1) ^ 
       ((crc_in>>0)&1) ^ ((crc_in>>1)&1) ^ ((crc_in>>2)&1) ^ ((crc_in>>3)&1) ^ ((crc_in>>4)&1) ^ ((crc_in>>5)&1) ^ ((crc_in>>6)&1) ^ ((crc_in>>7)&1) ^ 
       ((crc_in>>8)&1) ^ ((crc_in>>9)&1) ^ ((crc_in>>10)&1) ^ ((crc_in>>11)&1) ^ ((crc_in>>12)&1) ^ ((crc_in>>14)&1) ^ ((crc_in>>15)&1)) << 15);

  return res;
}
